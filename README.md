### Работа с памятью

1. [Как работают механизмы управления памятью в Linux](#kak_rabotayut_mekhanizmy_upravleniya_pamyaty_Linux)
2. [Как находить процессы которые занимают память](#kak_nakhodit_protsessy_kotoryye_zanimayut_pamyat)
3. [Разобраться в статической информации по памяти в Linux](#razobratsya_staticheskoy_informatsii_po_pamyati) 
4. [Дополнительные источники](#recommended_sources)




#### 1. [[⬆]](#toc) <a name='kak_rabotayut_mekhanizmy_upravleniya_pamyaty_Linux'>Как работают механизмы управления памятью в Linux</a>

В Linux есть два вида памяти: виртуальная и физическая память. 

**Виртуальная память** - позволяет "обманывать" ПО. Другими словами, если ПО запросит 10Гб памяти, а реально на "машине" только 10Гб, этому ПО будет "предоставлено" нужное ему колличество памяти из виртуальной памяти, и только тогда, когда программа начнет записывать, система создаст карту соответствия виртуального адресного пространства физическому адресному пространству, и программе будет выделенна реальная ячейка памяти.

Виртуальная память - это еще не память. Это всего лишь адресное пространство. Когда процессу веделили 10Гб, то физически еще ничего не распределилось. Система пока даже не озадачилась где будет хранить эти данные. Возможно, что у нее даже нет места для хранения этой информации (`over connect memory`).

А вот когда программа внутри процесса начала что-то записывать в свою виртуальную память, которую ей выделила система, вот в этот момент начинает заниматся реальная физическая оперативная память. В утилете TOP можно увидеть два столбца **virt** и **res**, `virt` - это виртуальная память, а `res` - раельная физическая память, которая используется процессом. То есть, система может выделить программе виртуальной памяти больше, чем есть на самом деле физической памяти.

Если получится так, что программа начнет записывать данные и превысит лимит в 10Гб, в этом случае "проснется" служба `Out-Of-Memory Killer` и завершит самый прожорливый процесс. Но, все на самом деле завит от настройки системы, которую можно настроить под свои предпочтения и запретить выделения большего объема памяти чем есть на самом деле.

```
sudo lshw -class memory 
sudo free -m
sudo du -sch ./<dir_name>/*

# Сбросить кэш
ls -l /proc/sys/vm/drop_caches
echo 3 > /proc/sys/vm/drop_caches
```

##### Команда free

| Статус | Описание |
| ------ | -------- |
| _total_ | информация о том, сколько свободно в системе за минусом то, что занимает Ядро |
| _used_ | сколько памяти потребляют приложения |
| _free_ | объем памяти, который на данный момент системе не нужен, то есть можно вытащить из системы |
| _shared_ | разделяемая память, память для межпроцессорного взаимодействия |
| _buff/cache_ | буфер и кэш |
| _available_ | сколько памяти будет доступно при необходимости |



```
cat /proc/meminfo
```

Swappiness. Это параметр sysctl, задающийся в файле /etc/sysctl.conf и позволяющий установить приоритеты доступа к оперативной памяти. Он может принимать значения от 0 до 200, значение по умолчанию равно 60
```
ls -l /proc/sys/vm/swappiness
cat /proc/sys/vm/swappiness
```

Этот  каталог  содержит  файлы  для тонкой настройки управления памятью, буферами и кэшем. Подробнее: https://manpages.ubuntu.com/manpages/oracular/ru/man5/proc_sys_vm.5.html
```
proc/sys/vm/
```

Swappiness. Это параметр sysctl, задающийся в файле /etc/sysctl.conf и позволяющий установить приоритеты доступа к оперативной памяти. Он может принимать значения от 0 до 200, значение по умолчанию равно 60
```
ls -l /proc/sys/vm/swappiness
cat /proc/sys/vm/swappiness
```

Этот  каталог  содержит  файлы  для тонкой настройки управления памятью, буферами и кэшем. Подробнее: https://manpages.ubuntu.com/manpages/oracular/ru/man5/proc_sys_vm.5.html
```
proc/sys/vm/
```


#### 2. [[⬆]](#toc) <a name='kak_nakhodit_protsessy_kotoryye_zanimayut_pamyat'>Как находить процессы которые занимают память</a>




#### 3. [[⬆]](#toc) <a name='razobratsya_staticheskoy_informatsii_po_pamyati'>Разобраться в статической информации по памяти в Linux</a>




#### 4. [[⬆]](#toc) <a name='recommended_sources'>Дополнительные источники</a>

1. [Linux и оперативная память](https://sysadminium.ru/adm-serv-linux-ram/)
2. [Управление памятью в Linux](https://habr.com/ru/articles/793232/)
3. [Информация об оперативной памяти в Linux](https://pingvinus.ru/note/ram-linux)
